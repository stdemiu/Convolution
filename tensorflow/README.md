# Применение свёрточного фильтра к изображению кота с помощью TensorFlow
TensorFlow: Основная библиотека для машинного обучения и обработки изображений. Здесь используется для выполнения свёртки.

## Загрузка изображения
```python
img_path = '/content/drive/MyDrive/Univer/cat.jpeg'
img = image.load_img(img_path, target_size=(224, 224))
```

- img_path: Путь к изображению на Google Диске.
- image.load_img: Загружает изображение и преобразует его в формат, понятный Keras.
- target_size=(224, 224): Изменяет размер изображения на 224×224 пикселя для унификации и уменьшения вычислительной нагрузки.

  
## Преобразование изображения в массив чисел
```python
img_array = image.img_to_array(img) / 255.0
image.img_to_array(img): Преобразует загруженное изображение в массив чисел, где каждый пиксель представлен тремя значениями (R, G и B).
/ 255.0: Нормализует значения в диапазон от 0 до 1, что упрощает обработку и улучшает стабильность свёрточной операции.
```
Преобразование изображения в массив чисел — это ключевой этап для работы с изображением в TensorFlow и других библиотеках машинного обучения. Преобразование позволяет представить изображение как набор численных значений, с которыми можно выполнять различные операции, включая свёртку. Нормализуем значения пикселей, разделив их на 255.0, чтобы привести значения к диапазону от 0 до 1.


## Добавление размерности для батча
```python
img_array = np.expand_dims(img_array, axis=0)
```
Каждый пиксель изображается тремя числовыми значениями (если изображение цветное). Эти три значения представляют интенсивности красного (R), зелёного (G) и синего (B) каналов.
Размерность массива будет (height, width, channels), где height — высота изображения в пикселях, width — ширина, а channels — количество каналов (3 для цветного изображения).
Нейронные сети TensorFlow ожидают, что входное изображение будет иметь размерность (batch_size, height, width, channels).
После преобразования изображения в массив значений его элементы остаются в диапазоне от 0 до 255 (типичный диапазон интенсивностей для каждого цветового канала). Чтобы нейронные сети могли лучше обрабатывать данные, их обычно нормализуют.Нормализация помогает улучшить эффективность и стабильность нейронных сетей. Когда значения находятся в диапазоне от 0 до 1, сети быстрее сходятся, так как не происходит сильных скачков в значениях весов и градиентов.

- expand_dims(..., axis=0): Добавляет новую размерность в начале массива, превращая его в форму (1, 224, 224, 3) (где 1 — размер батча).
 
## Подготовка ядра для применения к цветному изображению
```python
kernel = np.expand_dims(kernel, axis=-1)
kernel = np.repeat(kernel, 3, axis=-1)
kernel = np.expand_dims(kernel, axis=-1)
kernel = np.repeat(kernel, 3, axis=-1)
```
Изображение имеет три канала (RGB), поэтому фильтр нужно преобразовать для работы с цветным изображением. Пошагово:

- expand_dims(kernel, axis=-1): Добавляет одно измерение, превращая ядро в форму 3×3×1.
- np.repeat(kernel, 3, axis=-1): Повторяет ядро по последней оси 3 раза, получая ядро 3×3×3. Теперь оно охватывает все три канала (RGB).
- expand_dims(kernel, axis=-1): Добавляет ещё одно измерение для совместимости с форматом свёрточного слоя, превращая ядро в 3×3×3×1.
- np.repeat(kernel, 3, axis=-1): Повторяет ещё раз для создания ядра в форме 3×3×3×3, чтобы каждый канал обрабатывался независимо.

Теперь это ядро можно применять к каждому каналу изображения.

## Применение свёртки к изображению
```python
conv_layer = tf.nn.conv2d(img_array, kernel, strides=[1, 1, 1, 1], padding='SAME')
```

- tf.nn.conv2d: Выполняет операцию свёртки.
- img_array: Входное изображение.
- kernel: Ядро свёртки.
- strides=[1, 1, 1, 1]: Определяет шаг свёртки. 1,1 означает, что свёртка будет применяться ко всем пикселям. [1, h_stride, w_stride, 1] — это формат, где 1 для начала и конца остаётся фиксированным.
- padding='SAME': Сохраняет исходные размеры изображения, добавляя нули по краям, чтобы выходное изображение было того же размера, что и входное (224x224).

Функция tf.nn.conv2d в TensorFlow выполняет операцию свёртки. Свёртка применяется к входному изображению с использованием ядра, скользящего по изображению с заданным шагом. Она возвращает новую матрицу (изображение) с пикселями, которые являются результатами свёртки. Шаг свёртки — это параметр, определяющий, на сколько пикселей ядро перемещается за один шаг. Шаги 1,1 для высоты и ширины означают, что 'SAME' — сохраняет исходные размеры изображения. Для этого добавляются нулевые пиксели («нуль-паддинг») по краям, чтобы ядро полностью покрывало области на границе изображения. 'VALID' — свёртка проводится только там, где ядро полностью помещается на изображении, что приводит к уменьшению размера выходного изображения. свёртка будет применяться ко всем соседним пикселям, без пропуска. Если бы шаги были больше 1, ядро перескакивало бы пиксели, уменьшая размер выходного изображения.

Благодаря padding='SAME', размер выходного изображения будет совпадать с размером входного (224x224), так как нули добавляются по краям. Ядро 3x3 будет скользить по каждому пикселю изображения с шагом 1, вычисляя сумму произведений соответствующих элементов ядра и изображения. Поскольку ядро имеет три канала входа и три канала выхода, результатом будет цветное изображение, на каждом канале которого выделены интересующие нас особенности, такие как контуры и резкие границы. Функция tf.nn.conv2d возвращает массив с результатом свёртки, где каждый пиксель указывает интенсивность признаков, обнаруженных с помощью ядра.


## Подготовка результата для визуализации
```python
conv_img = np.squeeze(conv_layer)
conv_img = np.clip(conv_img, 0, 1)
```

- np.squeeze: Удаляет измерение размера батча, чтобы преобразовать изображение из 224,224,3, что делает его подходящим для визуализации.
np.clip(conv_img, 0, 1): Ограничивает значения от 0 до 1, так как при свёртке могут появляться значения вне этого диапазона.


После применения свёртки результат сохраняется в тензоре с дополнительным измерением для батча, и значения пикселей могут выходить за пределы диапазона [0,1]. 
Результат свёртки conv_layer имеет форму (1, 224, 224, 3):
- 1 — размер батча.
- 224, 224 — размеры изображения.
- 3 — количество каналов (R, G, B).
Так как мы обрабатывали одно изображение, размер батча равен 1. Однако для визуализации он не нужен, и изображение должно иметь размер 224×224×3.
Функция np.squeeze удаляет размер батча, преобразуя тензор из формы (1, 224, 224, 3) в (224, 224, 3). Теперь это обычное трёхканальное изображение, которое можно визуализировать с помощью plt.imshow.

После свёртки значения в conv_img могут выйти за диапазон [0,1]. Например, положительные края могут стать ярче и превысить 1, а отрицательные значения возникнут из-за работы ядра свёртки. np.clip(conv_img, 0, 1) ограничивает все значения в массиве:
- Все значения меньше 0 устанавливаются на 0.
- Все значения больше 1 устанавливаются на 1.
Это важно, потому что plt.imshow интерпретирует значения в диапазоне [0,1] для правильного отображения цвета и яркости.

conv_img становится трёхмерным массивом размером (224, 224, 3), готовым к отображению.
Все значения ограничены диапазоном [0,1], что позволяет корректно визуализировать изображение, так как яркость и цвета будут в нужном диапазоне.


## Визуализация исходного и обработанного изображений
```python
plt.figure(figsize=(10, 5))
plt.subplot(1, 2, 1)
plt.imshow(img_array[0])  # Отображаем нормализованное изображение
plt.title('Оригинальное изображение')

plt.subplot(1, 2, 2)
plt.imshow(conv_img)
plt.title('Изображение после свертки')

plt.show()
```

- plt.figure(figsize=(10, 5)): Создаёт фигуру для отображения изображений.
- plt.subplot(1, 2, 1): Разделяет фигуру на два поля (1 строка, 2 столбца) и активирует первое поле для отображения оригинального изображения.
- plt.imshow(img_array[0]): Отображает оригинальное изображение. Здесь img_array[0] — это нормализованное изображение в формате 224x224 с 3 каналами.
- plt.subplot(1, 2, 2): Активирует второе поле для отображения изображения после свёртки.
- plt.imshow(conv_img): Отображает изображение после свёртки. conv_img — это выходное изображение, где края выделены с помощью ядра.
- plt.show(): Показывает оба изображения (исходное и после свёртки) в одной фигуре.
